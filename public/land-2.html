<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>land #2 - in etherea we are away singing</title>
  <link rel="stylesheet" href="./assets/styles/main.css" type="text/css">
      
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
      
  <style type="text/css">
   
			#blocker {
				position: absolute;
				width: 100%;
				height: 100%;
                pointer-events: none;
			}
      
      .overlay-test{
          position: fixed;
          width:100%;
          height:100%;
          top:0;left:0;
          z-index:9;
          opacity:0.4;
          
          mix-blend-mode: multiply;
          pointer-events: none;
          
      }
      
      .overlay-test img{
          width:100%;
          height:100%;
      }
      
      #header{
          background-image:url(assets/header-cover.png);
          height:130px;
      }

  </style>
      
      
  </head>
  <body>
      
      
      <div class="header" id="header">
          
          <div class="travel-audio">
            <!-- PLACE AUDIO CONTROL HERE 
                For each land you must 
            -->
          </div>
          
      <label>Travel</label>
          
        <div class="travel-directions">
          <a href="">←</a> &nbsp;
          
          Land N
          
          &nbsp;
          <a href="">→</a>
        </div>
      </div>
      
      <div class="overlay-test"><img src="https://i.pinimg.com/564x/df/8a/ce/df8ace7a82fd5696377877df84d35d6a.jpg"></div>
      
      <div class="container" id="container" >
          
          <div class="landscape"> 
          
          
          </div>

          
    </div>
      
    <script src="https://unpkg.com/three"></script>
    <script src="https://unpkg.com/@seregpie/three.text-texture"></script>
    <script src="https://unpkg.com/@seregpie/three.text-sprite"></script>
  
      <script type="module">
          
          import { TrackballControls } from './assets/scripts/trackballcontrols.js';
          import { CSS3DRenderer, CSS3DObject } from './assets/scripts/css3renderer.js';
          
          // fix blurry text
          
          var perspectiveCamera, orthographicCamera, controls, scene, renderer, stats;

			var params = {
				orthographicCamera: false
			};

			var frustumSize = 400;

			init();
			animate();

			function init() {

				var aspect = window.innerWidth / window.innerHeight;

				perspectiveCamera = new THREE.PerspectiveCamera( 60, aspect, 1, 1000 );
				perspectiveCamera.position.z = 300;

				orthographicCamera = new THREE.OrthographicCamera( frustumSize * aspect / - 2, frustumSize * aspect / 2, frustumSize / 2, frustumSize / - 2, 1, 1000 );
				orthographicCamera.position.z = 500;

				// world

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xffffff );
				scene.fog = new THREE.FogExp2( 0xffffff, 0.003 );

				var geometry = new THREE.CylinderBufferGeometry( 0, 10, 30, 4, 1 );
				var material = new THREE.MeshPhongMaterial( { color: 0xffffff, flatShading: true } );
                
                
                var cssRenderer = new CSS3DRenderer();

                cssRenderer.setSize( window.innerWidth, window.innerHeight );
                cssRenderer.domElement.style.top = 0;


                var geometry = new THREE.PlaneGeometry( 1000, 1000, 1, 1 );
                var material = new THREE.MeshBasicMaterial( { color: 0x0000ff } );
                var floor = new THREE.Mesh( geometry, material );
                floor.material.side = THREE.DoubleSide;
                floor.rotation.x = 90;
                floor.position.set(0, -50, 0);
                
                
                scene.add( floor );

                /* 
				for ( var i = 0; i < 50; i ++ ) {

					var mesh = new THREE.Mesh( geometry, material );
					mesh.position.x = ( Math.random() - 0.5 ) * 200;
					mesh.position.y = ( Math.random() - 0.5 ) * 500;
					mesh.position.z = ( Math.random() - 0.5 ) * 200;
					mesh.updateMatrix();
					mesh.matrixAutoUpdate = false;
					scene.add( mesh );

				} */


                function addText(text, maxWidth, x, y, z, color, size, rotation){

                  function wrapText(context, text, x, y, maxWidth, lineHeight) {
                        var words = text.split(' ');
                        var line = '';

                        for(var n = 0; n < words.length; n++) {
                          var testLine = line + words[n] + ' ';
                          var metrics = context.measureText(testLine);
                          var testWidth = metrics.width;
                          if (testWidth > maxWidth && n > 0) {
                            context.fillText(line, x, y);
                            line = words[n] + ' ';
                            y += lineHeight;
                          }
                          else {
                            line = testLine;
                          }
                        }
                        context.fillText(line, x, y);
                        context.translate(0.5, 0.5);
                      }
                    

                       var canvas1 = document.createElement('canvas');
                        canvas1.imageSmoothingEnabled = false;

                        canvas1.width = canvas1.width * 2;
                        canvas1.height = canvas1.height * 2;
                    
                        var context1 = canvas1.getContext('2d');
                        context1.font = "Bold " + size + "px Arial";
                        context1.fillStyle = color;

                        wrapText(context1, text, 0, 30, maxWidth, size + 3);
                        context1.imageSmoothingEnabled = false;

                        var texture1 = new THREE.Texture(canvas1);
                        texture1.needsUpdate = true;

                        var material1 = new THREE.MeshBasicMaterial( { map: texture1, side:THREE.DoubleSide } );

                        material1.transparent = true;
                    
                    console.log(canvas1.width);
                    console.log(canvas1.height);
                    
                        var mesh1 = new THREE.Mesh(
                            new THREE.PlaneGeometry(canvas1.width / 2.2, canvas1.height / 2.2),
                            material1
                        );
                    
                    
                    // adjust based on canvas funkiness
                        mesh1.position.set(x + 100, y, z);
                    
                    // rotate
                        if(rotation){
                            mesh1.rotation.set(rotation.x * (Math.PI/180), rotation.y * (Math.PI/180), rotation.z * (Math.PI/180));
                        }

                        scene.add( mesh1 );

                }
                
                
                let pieces = [
                    
                    /*
                    
                    text MULTILINE!
                    location X Y Z
                    width HOW BIG
                    size FONT-SIZE IN PX
                    
                    {
                    text: `THE GHOST OF BOB SAGET CAME TO ME IN A DREAM `,
                    
                    location: [50, 150, -100],
                    width: 50,
                    size: 5
                    },
                    
                    */
                    
                    
                    
                    {
                    text: `alive where we glisten together like sovereigns lonely in the names of gods. i frolic sobbing on platforms like wisps, wishing for the last of anything but this.`,
                    location: [0, -30, 0],
                    width: 400
                    },
                    
                    {
                    text: `THE GHOST OF BOB SAGET CAME TO ME IN A DREAM `,
                    location: [50, 150, -100],
                    width: 50
                    },
                    
                    {
                    text: `inside there is a tortorous, magnificent door beckoning of a place years to come. i feel her faintly, scratches and all——pressed my ear onto the nape of the evergreen and see behind the slints a new world`,
                    location: [-50, -50, 20],
                    width: 120,
                    size: 9,
                    rotation: {
                        x: 0,
                        y: 20,
                        z: 0
                    }
                    },
                    
                    {
                    text: `the land is rich and green and pure. a bovine carcass rests on the land, dust and ash whirling against a rising, drappling sky. my girl climbs slowly on hilltops`,
                    location: [-75, -100, 70],
                    width: 650,
                    size: 14
                    }
                    
                    
                ];
                
                
                
                for(let i=0;i<pieces.length; i++){
                    
                    let color = "rgb(0, 0, 0)";
                    let size = 12; // def
                    let rotation;
                    
                    let p = pieces[i];
                    
                    if(p.size){ size = p.size }
                    if(p.rotation){ rotation = p.rotation }
                    
                    addText(p.text, p.width, p.location[0], p.location[1], p.location[2], color, size, rotation);
                            
                    
                }

                
                // create the plane mesh
                var material = new THREE.MeshBasicMaterial({ wireframe: true });
                var geometry = new THREE.PlaneGeometry();
                var planeMesh= new THREE.Mesh( geometry, material );
                // add it to the WebGL scene
                
                scene.add(planeMesh); 
                
                


                
                
				// lights

				var light = new THREE.DirectionalLight( 0xffffff );
				light.position.set( 1, 1, 1 );
				scene.add( light );

				var light = new THREE.DirectionalLight( 0x7e93d3 );
				light.position.set( - 1, - 1, - 1 );
				scene.add( light );

				var light = new THREE.AmbientLight( 0xffc9c9 );
				scene.add( light );

				// renderer

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				$(".landscape").html( renderer.domElement );


				//


				//

				window.addEventListener( 'resize', onWindowResize, false );

				createControls( perspectiveCamera );

			}

			function createControls( camera ) {

				controls = new TrackballControls( camera, renderer.domElement );

				controls.rotateSpeed = 1.0;
				controls.zoomSpeed = 1.2;
				controls.panSpeed = 0.8;

				controls.keys = [ 65, 83, 68 ];

			}

			function onWindowResize() {

				var aspect = window.innerWidth / window.innerHeight;

				perspectiveCamera.aspect = aspect;
				perspectiveCamera.updateProjectionMatrix();

				orthographicCamera.left = - frustumSize * aspect / 2;
				orthographicCamera.right = frustumSize * aspect / 2;
				orthographicCamera.top = frustumSize / 2;
				orthographicCamera.bottom = - frustumSize / 2;
				orthographicCamera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

				controls.handleResize();

			}

			function animate() {

				requestAnimationFrame( animate );

				controls.update();


				render();

			}

			function render() {

				var camera = ( params.orthographicCamera ) ? orthographicCamera : perspectiveCamera;

				renderer.render( scene, camera );

			}

      </script>
      
      
  </body>
</html>